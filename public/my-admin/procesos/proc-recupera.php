<?php	session_start();	require("../scripts/gump.class.php");	$gump = new GUMP();	$_GET = $gump->sanitize($_GET);	$_POST = $gump->sanitize($_POST);
	if(!empty($_POST['btn_acceder'])):		if(isset($_POST['login']) && $_POST['login']!=""):			require("../conexion.php");
			$login = str_replace("'", "", str_replace(" ", "", $_POST['login']));			$query = "SELECT idUser, login, email FROM ctlg_usuarios WHERE login='$login' or email='$login' LIMIT 0,1";			$result = mysql_query($query);
			if($result && mysql_num_rows($result)==1):				$row = mysql_fetch_array($result);				require("../scripts/class.phpmailer.php");				require("../scripts/funciones.php");
				$mail = new PHPMailer();				$mail->IsMail();				$mail->IsHTML(true);				$mail->FromName = "Sistema de recuperaci&oacute;n de contrase&ntilde;a";				$mail->Subject  = "Recuperaci&oacute;n de contrase&ntilde;a";				$mail->Port = 26;				$mail->WordWrap = 50;				$pass = GeneraPassword(5);				$body ="
				<html>				<head>				<title>Mensaje del sistema de recuperaci&oacute;n de contrase&ntilde;a</title>				</head>				<body>					Mensaje del sistema de recuperaci&oacute;n de cuenta<br/><br/>					<strong>Usuario:</strong> $login<br/>					<strong>Nueva contrase&ntilde;a :</strong> $pass<br/>				</body>				</html>";
				$mail->Body = $body;				$mail->AddAddress($row['email']);
				if($mail->Send()):					$id = $row['idUser'];					$pass_sha1 = sha1($pass);					$query = "UPDATE ctlg_usuarios SET password='$pass_sha1' WHERE idUser='$id'";					$result = mysql_query($query);					$mensaje = "Tu nueva contrase&ntilde;a a sido enviada a tu E-mail.";					$clase = "exito";				else:					$mensaje = "El correo no pude ser enviado. El password no se cambiara.";					$clase = "error";				endif;			else:				$mensaje = "El nombre de usuario o el e-mail no son correctos.";				$clase = "error";			endif;		else:			$mensaje = "El nombre de usuario o el e-mail no son correctos.";			$clase = "alerta";		endif;		$_SESSION['resultado'] = array(			"mensaje"=>$mensaje,			"clase"=>$clase		);		header("Location:../recupera.php");	endif;?>